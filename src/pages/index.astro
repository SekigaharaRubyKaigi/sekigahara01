---
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';
import logoImage from '../assets/main-visual.svg';
import akaKabuto from '../assets/aka-kabutosan.svg';
import aoKabuto from '../assets/ao-kabutosan.svg';
import pinBlack from '../assets/pin_black.svg';
import LinkButton from '../components/LinkButton.astro';

// ▼ ニュース機能の読み込み
import { getCollection } from 'astro:content';

// データを取得
let latestNews = [];
try {
  const allNews = await getCollection('news');
  const sortedNews = allNews.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
  latestNews = await Promise.all(
    sortedNews.slice(0, 3).map(async (post) => ({
      ...post,
      Content: (await post.render()).Content,
    }))
  );
} catch (e) {
  console.error("News loading failed:", e);
}

// 日付フォーマット関数
const formatDate = (date) => {
  if (!date) return '';
  return date.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit'
  }).replace(/\//g, '.'); // 2024/08/05 -> 2024.08.05
};
---

<Layout title="関ケ原Ruby会議01">
  <div class="w-full pb-1">

    <div class="text-center py-10 md:py-20">
      <div class="mx-auto w-80 mb-6 relative">
        <Image 
          src={logoImage} 
          alt="関ケ原Ruby会議01メインビジュアル" 
          class="w-full h-auto object-contain" 
        />
      </div>

      <h1 class="text-4xl md:text-6xl font-extrabold mb-4 text-[#332F2E]">
        関ケ原Ruby会議01
      </h1>

      <p class="text-2xl md:text-3xl font-bold mb-6 text-[#332F2E]">
        2026.05.30(土)
      </p>

      <p class="text-base md:text-xl text-[#332F2E]">
        会場: <a href="https://www.town.sekigahara.gifu.jp/2568.htm"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:opacity-70 transition-opacity underline"
        >関ケ原ふれあいセンター</a>
      </p>
    </div>

    <section id="about" class="max-w-screen-md mx-auto mb-20">
      <div class="bg-white/90 p-10 md:p-16 rounded-xl shadow-lg text-[#332F2E]">
        <div class="mb-8">
          <h2 class="text-3xl md:text-4xl font-bold text-center tracking-wider font-sans">
            About
          </h2>
          <div class="h-2 w-16 mx-auto mt-4 bg-gradient-to-r from-[#fc2158] to-[#0e0aca]"></div>
        </div>
        <div class="text-lg leading-relaxed">
          <p class="mb-4">
            関ケ原Ruby会議01は、天下分け目の地「関ケ原」で開催される地域Ruby会議です。
          </p>
          <p>
            歴史ある古戦場で、新たなRubyの歴史を刻みましょう。
          </p>
        </div>
      </div>
    </section>

    <section id="news" class="max-w-screen-md mx-auto mb-20">
      <div class="bg-white/90 p-10 md:p-16 rounded-xl shadow-lg">
        <div class="mb-8">
          <h2 class="text-3xl md:text-4xl font-bold text-center text-[#332F2E] tracking-wider font-sans">
            News
          </h2>
          <div class="h-2 w-16 mx-auto mt-4 bg-gradient-to-r from-[#fc2158] to-[#0e0aca]"></div>
        </div>

      <div class="bg-white rounded-xl overflow-hidden">
        {latestNews.length === 0 ? (
          <p class="p-8 text-center text-gray-500">現在お知らせはありません。</p>
        ) : (
          <div class="divide-y divide-gray-200/50">
            {latestNews.map((post) => {
              return (
                <article class="p-6">
                  <div class="flex flex-col gap-4">
                    <div class="flex flex-col md:flex-row md:items-baseline gap-2 md:gap-6">
                      <time class="font-bold text-gray-600 font-sans min-w-[100px]">
                        {formatDate(post.data.date)}
                      </time>
                      <h3 class="flex-grow font-bold text-[#332F2E] text-lg md:text-xl leading-[1.5]">
                        {post.data.title}
                      </h3>
                    </div>
                    <div class="text-[#332F2E] text-base leading-[1.8]">
                      <post.Content />
                    </div>
                  </div>
                </article>
              );
            })}
          </div>
        )}
      </div>

        <div class="mt-6">
          <LinkButton href="/sekigahara01/news" text="もっと見る" variant="secondary" />
        </div>
      </div>
    </section>

    <div class="flex justify-center items-end gap-12 mt-20 mb-0">
      <div class="sway-animation">
        <Image
          src={akaKabuto}
          alt="あかかぶとさん"
          class="w-24 h-24 md:w-32 md:h-32 lg:w-40 md:h-40"
        />
      </div>
      <div class="sway-animation" style="animation-delay: 0.5s;">
        <Image
          src={aoKabuto}
          alt="あおかぶとさん"
          class="w-24 h-24 md:w-32 md:h-32 lg:w-40 md:h-40"
        />
      </div>
    </div>

  </div>
</Layout>

<style>
  @keyframes sway {
    0%, 100% {
      transform: rotate(-5deg);
    }
    50% {
      transform: rotate(5deg);
    }
  }

  .sway-animation {
    animation: sway 4s ease-in-out infinite;
  }
</style>
