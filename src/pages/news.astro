---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// データを取得
let allNews = [];
try {
  const newsCollection = await getCollection('news');
  const sortedNews = newsCollection.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
  allNews = await Promise.all(
    sortedNews.map(async (post) => ({
      ...post,
      Content: (await post.render()).Content,
    }))
  );
} catch (e) {
  console.error("News loading failed:", e);
}

// 日付フォーマット関数
const formatDate = (date) => {
  if (!date) return '';
  return date.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit'
  }).replace(/\//g, '.'); // 2024/08/05 -> 2024.08.05
};
---

<Layout title="News - 関ケ原Ruby会議01" alignTop={true}>
  <div class="w-full py-10 md:py-20">

    <div class="max-w-screen-md mx-auto">
      <div class="bg-white/90 p-10 md:p-16 rounded-xl shadow-lg">
        <div class="mb-8">
          <h1 class="text-3xl md:text-4xl font-bold text-center text-[#332F2E] tracking-wider font-sans">
            News
          </h1>
          <div class="h-2 w-16 mx-auto mt-4 bg-gradient-to-r from-[#fc2158] to-[#0e0aca]"></div>
        </div>

      <div class="bg-white rounded-xl overflow-hidden">
        {allNews.length === 0 ? (
          <p class="p-8 text-center text-gray-500">現在お知らせはありません。</p>
        ) : (
          <div class="divide-y divide-gray-200/50">
            {allNews.map((post) => {
              return (
                <article class="p-6">
                  <div class="flex flex-col gap-4">
                    <div class="flex flex-col md:flex-row md:items-baseline gap-2 md:gap-6">
                      <time class="font-bold text-gray-600 font-sans min-w-[100px]">
                        {formatDate(post.data.date)}
                      </time>
                      <h3 class="flex-grow font-bold text-[#332F2E] text-lg md:text-xl leading-[1.5]">
                        {post.data.title}
                      </h3>
                    </div>
                    <div class="text-[#332F2E] text-base leading-[1.8] news-content">
                      <post.Content />
                    </div>
                  </div>
                </article>
              );
            })}
          </div>
        )}
      </div>
      </div>
    </div>

  </div>
</Layout>

<style is:global>
  .news-content p a,
  .news-content a {
    text-decoration: underline !important;
    text-decoration-thickness: 1px !important;
    text-underline-offset: 2px !important;
    color: #332F2E;
    transition: opacity 0.2s;
  }
  .news-content p a:hover,
  .news-content a:hover {
    opacity: 0.7;
  }
</style>
